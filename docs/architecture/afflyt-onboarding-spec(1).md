# Afflyt Pro - Onboarding Technical Specification

## Specifica Tecnica Completa

**Data:** Dicembre 2024  
**Versione:** 2.0  
**Status:** Da implementare per Beta  
**Basato su:** Merge onboarding esistente + nuovo sistema ottimizzazione

---

## Executive Summary

L'onboarding guida l'utente dalla registrazione alla prima automazione attiva in ~5 minuti. Raccoglie due tipi di informazioni:

1. **Persona Type** â€” Chi Ã¨ l'utente (esperienza, risorse) â†’ personalizza UX
2. **Audience Type** â€” Chi sono i suoi iscritti â†’ alimenta algoritmo scoring

---

## Architettura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ONBOARDING ARCHITECTURE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ localStorageâ”‚â”€â”€â”€â–¶â”‚ React State â”‚â”€â”€â”€â–¶â”‚  Database   â”‚         â”‚
â”‚  â”‚  (resume)   â”‚    â”‚  (UI flow)  â”‚    â”‚ (permanent) â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚        â”‚                  â”‚                  â”‚                  â”‚
â”‚        â”‚                  â”‚                  â”‚                  â”‚
â”‚        â–¼                  â–¼                  â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Analytics Layer                       â”‚   â”‚
â”‚  â”‚              (PostHog / Custom Events)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. Flow Overview

### 1.1 Step Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ONBOARDING FLOW (6 STEPS)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Step 1  â”‚â”€â”€â–¶â”‚ Step 2  â”‚â”€â”€â–¶â”‚ Step 3  â”‚â”€â”€â–¶â”‚ Step 4  â”‚        â”‚
â”‚  â”‚ Welcome â”‚   â”‚ Channel â”‚   â”‚   Bot   â”‚   â”‚Audience â”‚        â”‚
â”‚  â”‚ Survey  â”‚   â”‚ Connect â”‚   â”‚  Setup  â”‚   â”‚  Type   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚       â”‚                                          â”‚              â”‚
â”‚       â”‚    [Quick Start - skip to Step 5]       â”‚              â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                  â”‚              â”‚
â”‚                                                  â–¼              â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                          â”‚ Step 5  â”‚â”€â”€â–¶â”‚ Step 6  â”‚â”€â”€â–¶ Dashboardâ”‚
â”‚                          â”‚  First  â”‚   â”‚Complete â”‚             â”‚
â”‚                          â”‚  Auto   â”‚   â”‚   ğŸ‰    â”‚             â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                               â”‚                                 â”‚
â”‚                          [Skip option]                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tempo stimato: 4-6 minuti
Tempo minimo (Quick Start): 2 minuti
```

### 1.2 Entry Points

| Entry Point | Comportamento |
|-------------|---------------|
| Nuovo utente (signup) | Inizia da Step 1 |
| Magic link (new user) | Inizia da Step 1 |
| Magic link (existing, incomplete) | Resume da localStorage |
| Magic link (existing, complete) | â†’ Dashboard |
| Direct URL `/onboarding` | Check stato, resume o redirect |

### 1.3 Exit Points

| Exit Point | Trigger | Stato Salvato |
|------------|---------|---------------|
| Quick Start (Step 1) | Click "Usa default" | Persona = beginner, â†’ Step 5 |
| Skip Channel (Step 2) | Click "Dopo" | Incomplete, â†’ Dashboard |
| Skip Bot (Step 3) | Click "Dopo" | Incomplete, â†’ Dashboard |
| Skip Automation (Step 5) | Click "Dopo" | Complete senza automation |
| Complete (Step 6) | Automatico | Complete |
| Abbandono | Chiude browser | localStorage preserva stato |

---

## 2. Step Details

### 2.1 Step 1: Welcome Survey

**Obiettivo:** Raccogliere info per calcolare Persona Type

**Substeps:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1 di 6 Â· Welcome                          [Quick Start â†’] â”‚
â”‚  â”â”â”â”â”â”â—‹â—‹â—‹â—‹â—‹â—‹                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    ğŸš€ Benvenuto in Afflyt!                      â”‚
â”‚                                                                 â”‚
â”‚     Il copilota AI per il tuo canale Telegram di offerte       â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  Per personalizzare la tua esperienza, rispondi a 2 domande:   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Qual Ã¨ il tuo livello di esperienza con              â”‚   â”‚
â”‚  â”‚     l'affiliate marketing?                               â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚     â—‹ Principiante                                       â”‚   â”‚
â”‚  â”‚       Non ho mai fatto affiliate marketing               â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚     â—‹ Intermedio                                         â”‚   â”‚
â”‚  â”‚       Ho giÃ  un canale e qualche esperienza              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚     â—‹ Avanzato                                           â”‚   â”‚
â”‚  â”‚       Gestisco canali da tempo, conosco bene il settore  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. Hai giÃ  un account Amazon Associates?                â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚     â—‹ SÃ¬, ce l'ho                                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚     â—‹ No, devo crearlo                                   â”‚   â”‚
â”‚  â”‚       [â„¹ï¸ Ti guideremo nel setup]                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Continua â†’                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [Quick Start â†’] Usa impostazioni consigliate e vai al setup   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Logic:**

```typescript
// Form data
interface WelcomeSurveyData {
  experienceLevel: 'beginner' | 'intermediate' | 'advanced';
  hasAmazonAssociates: boolean;
}

// Persona calculation
function calculatePersonaType(data: WelcomeSurveyData): PersonaType {
  if (data.experienceLevel === 'advanced' && data.hasAmazonAssociates) {
    return 'power_user';
  }
  if (data.experienceLevel === 'intermediate' && data.hasAmazonAssociates) {
    return 'monetizer';
  }
  if (data.experienceLevel === 'intermediate' && !data.hasAmazonAssociates) {
    return 'creator';
  }
  return 'beginner';
}

// Quick Start defaults
const QUICK_START_DEFAULTS: WelcomeSurveyData = {
  experienceLevel: 'beginner',
  hasAmazonAssociates: false
};
```

**API Call (on continue):**

```typescript
// PATCH /api/auth/persona
{
  experienceLevel: 'intermediate',
  hasAmazonAssociates: true,
  personaType: 'monetizer' // calculated
}
```

**Conditional: Amazon Associates Guide**

Se `hasAmazonAssociates === false`, mostra inline:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ Come creare un account Amazon Associates                    â”‚
â”‚                                                                 â”‚
â”‚  1. Vai su affiliate-program.amazon.it                         â”‚
â”‚  2. Clicca "Iscriviti"                                         â”‚
â”‚  3. Completa la registrazione (serve partita IVA o CF)         â”‚
â”‚  4. Attendi approvazione (24-48h)                              â”‚
â”‚                                                                 â”‚
â”‚  Puoi continuare il setup di Afflyt mentre aspetti.            â”‚
â”‚  Ti chiederemo il tag Amazon piÃ¹ tardi.                        â”‚
â”‚                                                                 â”‚
â”‚  [ğŸ“– Guida completa]  [ğŸ“¹ Video tutorial]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.2 Step 2: Channel Connect

**Obiettivo:** Identificare il canale Telegram da collegare

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2 di 6 Â· Canale                                [â† Indietro]â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â—‹â—‹â—‹â—‹â—‹                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    ğŸ“± Collega il tuo canale                     â”‚
â”‚                                                                 â”‚
â”‚  Inserisci il link o username del tuo canale Telegram          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Username o link del canale                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ @                                                  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Esempi: @miocanale, t.me/miocanale, -1001234567890     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â„¹ï¸ Requisiti                                            â”‚   â”‚
â”‚  â”‚  â€¢ Devi essere amministratore del canale                â”‚   â”‚
â”‚  â”‚  â€¢ Il canale puÃ² essere pubblico o privato              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Verifica Canale â†’                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Non hai un canale? [Crea un canale Telegram â†’]                â”‚
â”‚  Vuoi collegarlo dopo? [Salta per ora]                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Validation:**

```typescript
// Input parsing
function parseChannelInput(input: string): { type: 'username' | 'id' | 'link', value: string } {
  const trimmed = input.trim();
  
  // Numeric ID: -1001234567890
  if (/^-?\d+$/.test(trimmed)) {
    return { type: 'id', value: trimmed };
  }
  
  // Link: t.me/channel or https://t.me/channel
  const linkMatch = trimmed.match(/(?:https?:\/\/)?t\.me\/([a-zA-Z][a-zA-Z0-9_]{4,})/);
  if (linkMatch) {
    return { type: 'username', value: linkMatch[1] };
  }
  
  // Username: @channel or channel
  const username = trimmed.replace(/^@/, '');
  if (/^[a-zA-Z][a-zA-Z0-9_]{4,}$/.test(username)) {
    return { type: 'username', value: username };
  }
  
  throw new Error('Formato non valido');
}
```

**API Call:**

```typescript
// POST /api/validate/telegram-channel
{
  channelIdentifier: '@miocanale' // or ID
}

// Response
{
  valid: true,
  channel: {
    id: '-1001234567890',
    username: 'miocanale',
    title: 'Mio Canale Offerte',
    memberCount: 1234,
    isPublic: true
  }
}

// Error responses
{ valid: false, error: 'CHANNEL_NOT_FOUND' }
{ valid: false, error: 'NOT_ADMIN' }
{ valid: false, error: 'PRIVATE_NO_ACCESS' }
```

**State saved:**

```typescript
onboardingState.channelData = {
  id: '-1001234567890',
  username: 'miocanale',
  title: 'Mio Canale Offerte',
  memberCount: 1234
};
```

---

### 2.3 Step 3: Bot Setup

**Obiettivo:** Configurare il bot Telegram che pubblicherÃ  i deal

**Substeps:**

```
3a. Crea il bot (istruzioni)
3b. Incolla il token
3c. Aggiungi bot come admin
3d. Verifica automatica
```

**UI - Substep 3a/3b:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3 di 6 Â· Bot Setup                             [â† Indietro]â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â—‹â—‹â—‹                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    ğŸ¤– Configura il Bot                          â”‚
â”‚                                                                 â”‚
â”‚  Per pubblicare su @miocanale, Afflyt usa un bot Telegram      â”‚
â”‚  che controlli tu. Segui questi passaggi:                       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â‘  Crea il bot su Telegram                              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  1. Apri @BotFather su Telegram                         â”‚   â”‚
â”‚  â”‚  2. Invia il comando /newbot                            â”‚   â”‚
â”‚  â”‚  3. Scegli un nome (es: "Mio Canale Deals Bot")        â”‚   â”‚
â”‚  â”‚  4. Scegli uno username (es: "MioCanaleDealsBot")      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  [Apri @BotFather â†’]                                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â‘¡ Incolla il token del bot                             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  BotFather ti ha dato un token tipo:                    â”‚   â”‚
â”‚  â”‚  123456789:ABCdefGHI-jklMNOpqrsTUVwxyz                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  ğŸ”’ Il token Ã¨ criptato e visibile solo a te           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Verifica Token â†’                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API Call - Token Validation:**

```typescript
// POST /api/validate/telegram-token
{
  token: '123456789:ABCdefGHI-jklMNOpqrsTUVwxyz'
}

// Response
{
  valid: true,
  bot: {
    id: 123456789,
    username: 'MioCanaleDealsBot',
    firstName: 'Mio Canale Deals Bot',
    canJoinGroups: true,
    canReadMessages: false
  }
}

// Error responses
{ valid: false, error: 'INVALID_TOKEN' }
{ valid: false, error: 'TOKEN_REVOKED' }
{ valid: false, error: 'BOT_BLOCKED' }
```

**UI - Substep 3c/3d:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3 di 6 Â· Bot Setup                             [â† Indietro]â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â—‹â—‹â—‹                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âœ“ Token valido: @MioCanaleDealsBot                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â‘¢ Aggiungi il bot come admin di @miocanale             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  1. Apri @miocanale su Telegram                         â”‚   â”‚
â”‚  â”‚  2. Tocca il nome del canale in alto                    â”‚   â”‚
â”‚  â”‚  3. Vai su "Amministratori"                             â”‚   â”‚
â”‚  â”‚  4. Tocca "Aggiungi amministratore"                     â”‚   â”‚
â”‚  â”‚  5. Cerca "@MioCanaleDealsBot"                          â”‚   â”‚
â”‚  â”‚  6. Abilita "Pubblica messaggi"                         â”‚   â”‚
â”‚  â”‚  7. Salva                                                â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  [ğŸ“– Guida con screenshot]  [ğŸ“¹ Video]                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Ho fatto, verifica â†’                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API Call - Admin Verification:**

```typescript
// POST /api/validate/telegram-bot-admin
{
  token: '123456789:ABCdef...',
  channelId: '-1001234567890'
}

// Response
{
  valid: true,
  permissions: {
    canPostMessages: true,
    canEditMessages: true,
    canDeleteMessages: false
  }
}

// Error responses
{ valid: false, error: 'BOT_NOT_MEMBER' }
{ valid: false, error: 'BOT_NOT_ADMIN' }
{ valid: false, error: 'MISSING_POST_PERMISSION' }
```

**On Success - Create Resources:**

```typescript
// 1. Create Credential
// POST /api/user/credentials
{
  type: 'TELEGRAM_BOT',
  name: 'MioCanaleDealsBot',
  encryptedToken: '...' // encrypted server-side
}

// 2. Create Channel
// POST /api/user/channels
{
  platform: 'TELEGRAM',
  channelId: '-1001234567890',
  name: 'Mio Canale Offerte',
  username: 'miocanale',
  credentialId: 'cred_xxx',
  memberCount: 1234
}
```

---

### 2.4 Step 4: Audience Type

**Obiettivo:** Identificare il tipo di pubblico per inizializzare l'algoritmo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4 di 6 Â· Il tuo pubblico                       [â† Indietro]â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â—‹â—‹                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    ğŸ¯ Che tipo di pubblico hai?                 â”‚
â”‚                                                                 â”‚
â”‚  Questo ci aiuta a scegliere le offerte migliori per il        â”‚
â”‚  tuo canale fin da subito.                                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â—‹ ğŸ¯ Cercano prodotti specifici                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚    I tuoi iscritti aspettano offerte su brand e         â”‚   â”‚
â”‚  â”‚    prodotti che giÃ  conoscono e desiderano.             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚    Esempio: "Aspetto che l'iPhone vada in sconto"       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â—‹ ğŸ›’ Amano scoprire occasioni                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚    I tuoi iscritti comprano d'impulso quando vedono     â”‚   â”‚
â”‚  â”‚    un prezzo incredibile, anche su prodotti nuovi.      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚    Esempio: "Wow, 70% di sconto? Lo prendo!"            â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â—‹ ğŸ® Nicchia specifica                                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚    Il tuo canale Ã¨ focalizzato su una categoria         â”‚   â”‚
â”‚  â”‚    precisa (tech, gaming, casa, sport...).              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚    Esempio: "Solo offerte gaming e setup"               â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â—‹ â“ Non so ancora                                      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚    Nessun problema! Afflyt imparerÃ  automaticamente     â”‚   â”‚
â”‚  â”‚    analizzando i risultati delle prime settimane.       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Continua â†’                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Mapping:**

| Selezione | audienceType | Pesi Iniziali Score |
|-----------|--------------|---------------------|
| Cercano prodotti | `product_hunters` | salesRank 40%, rating 25%, discount 25%, priceDrop 10% |
| Amano scoprire | `deal_explorers` | discount 50%, salesRank 10%, rating 25%, priceDrop 15% |
| Nicchia specifica | `niche_focused` | rating 30%, discount 30%, salesRank 25%, priceDrop 15% |
| Non so ancora | `unknown` | Default (discount 40%, salesRank 25%, rating 20%, priceDrop 15%) |

**API Call:**

```typescript
// PATCH /api/channels/:id
{
  audienceType: 'product_hunters',
  audienceTypeSource: 'onboarding',
  audienceTypeConfidence: 0.5 // iniziale, aumenta con dati
}
```

---

### 2.5 Step 5: First Automation

**Obiettivo:** Creare la prima automazione attiva

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5 di 6 Â· Prima automazione                     [â† Indietro]â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â—‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    âš¡ Crea la tua prima automazione             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Nome automazione                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Offerte Tech                                       â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Categorie (seleziona almeno 1)                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â˜‘ Elettronica         â˜ Casa e Cucina                  â”‚   â”‚
â”‚  â”‚  â˜‘ Informatica         â˜ Sport e Tempo Libero           â”‚   â”‚
â”‚  â”‚  â˜ Telefonia           â˜ Giardino e Giardinaggio        â”‚   â”‚
â”‚  â”‚  â˜ Audio e Hi-Fi       â˜ Moda                           â”‚   â”‚
â”‚  â”‚  â˜ TV e Home Cinema    â˜ Bellezza                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  [Mostra tutte le categorie â–¾]                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Frequenza di pubblicazione                              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â—‰ Rilassata â€” ogni 6 ore, ~3 deal/giorno               â”‚   â”‚
â”‚  â”‚    Consigliata per iniziare                              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â—‹ Attiva â€” ogni 2 ore, ~8 deal/giorno                  â”‚   â”‚
â”‚  â”‚    Per canali con pubblico attivo                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â—‹ Intensiva â€” ogni ora, ~15 deal/giorno [PRO]          â”‚   â”‚
â”‚  â”‚    Per canali ad alto volume                             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ’¡ Consiglio: Inizia con "Rilassata". Potrai sempre    â”‚   â”‚
â”‚  â”‚     aumentare la frequenza dopo aver visto i risultati. â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                Crea e Attiva Automazione                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Preferisci configurare dopo? [Salta per ora]                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Preset Mapping:**

| Preset | Intervallo | Deal/Run | minScore |
|--------|------------|----------|----------|
| relaxed | 360 min (6h) | 3 | 45 |
| active | 120 min (2h) | 3 | 45 |
| intensive | 60 min (1h) | 5 | 45 |

**minScore per Persona Type:**

| Persona | minScore Default |
|---------|------------------|
| beginner | 50 (piÃ¹ selettivo) |
| creator | 45 |
| monetizer | 40 |
| power_user | 35 (piÃ¹ libertÃ ) |

**API Call:**

```typescript
// POST /api/automation/rules
{
  name: 'Offerte Tech',
  channelId: 'ch_xxx',
  categories: ['electronics', 'computers'],
  schedulePreset: 'relaxed',
  minScore: 50,
  isActive: true,
  publishingMode: 'smart' // default
}
```

---

### 2.6 Step 6: Completion

**Obiettivo:** Celebrare, spiegare, guidare prossimi passi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6 di 6 Â· Completato!                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                         ğŸ‰                                      â”‚
â”‚                                                                 â”‚
â”‚                    Tutto pronto!                                â”‚
â”‚                                                                 â”‚
â”‚  La tua prima automazione Ã¨ attiva su @miocanale               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  ğŸ“Š Cosa succede ora:                                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â€¢ Afflyt cerca offerte ogni 6 ore                      â”‚   â”‚
â”‚  â”‚  â€¢ Le migliori vengono pubblicate automaticamente       â”‚   â”‚
â”‚  â”‚  â€¢ Il sistema impara cosa funziona per il tuo pubblico  â”‚   â”‚
â”‚  â”‚  â€¢ Ti avvisiamo quando scopriamo qualcosa di utile      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ”” Vuoi essere avvisato quando pubblichiamo?           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Ricevi una notifica su Telegram ogni volta che        â”‚   â”‚
â”‚  â”‚  un deal viene pubblicato sul tuo canale.              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚         Attiva notifiche Telegram                â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  [No grazie, magari dopo]                               â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Vai alla Dashboard â†’                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ“‹ Prossimo passo consigliato: Collega il tuo tag Amazon     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API Calls:**

```typescript
// 1. Mark onboarding complete
// PATCH /api/auth/persona
{
  onboardingCompletedAt: new Date().toISOString()
}

// 2. (Optional) Enable Telegram notifications
// POST /api/user/notification-settings
{
  telegramNotifications: true,
  notifyOnDealPublished: true
}
```

**Cleanup:**

```typescript
// Clear localStorage
localStorage.removeItem('onboarding_state');

// Redirect
router.push('/dashboard');
```

---

## 3. State Management

### 3.1 localStorage Schema

```typescript
interface OnboardingState {
  // Current position
  currentStep: 'welcome' | 'channel' | 'bot' | 'audience' | 'automation' | 'complete';
  currentSubstep?: number;
  
  // Step 1: Welcome
  welcomeData?: {
    experienceLevel: 'beginner' | 'intermediate' | 'advanced';
    hasAmazonAssociates: boolean;
    personaType: PersonaType;
    completedAt: string;
  };
  
  // Step 2: Channel
  channelData?: {
    id: string;
    username: string;
    title: string;
    memberCount: number;
    completedAt: string;
  };
  
  // Step 3: Bot
  botData?: {
    id: number;
    username: string;
    tokenPrefix: string; // first 10 chars only, for display
    verified: boolean;
    completedAt: string;
  };
  
  // Step 4: Audience
  audienceData?: {
    audienceType: AudienceType;
    completedAt: string;
  };
  
  // Step 5: Automation
  automationData?: {
    created: boolean;
    skipped: boolean;
    automationId?: string;
    completedAt: string;
  };
  
  // Metadata
  startedAt: string;
  lastUpdatedAt: string;
  totalTimeSpent: number; // seconds
  
  // Skip tracking
  skippedSteps: string[];
}

const STORAGE_KEY = 'afflyt_onboarding_state';
```

### 3.2 State Hooks

```typescript
// hooks/useOnboardingState.ts

export function useOnboardingState() {
  const [state, setState] = useState<OnboardingState | null>(null);
  
  // Load on mount
  useEffect(() => {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      setState(JSON.parse(saved));
    } else {
      const initial: OnboardingState = {
        currentStep: 'welcome',
        startedAt: new Date().toISOString(),
        lastUpdatedAt: new Date().toISOString(),
        totalTimeSpent: 0,
        skippedSteps: []
      };
      setState(initial);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(initial));
    }
  }, []);
  
  // Save on change
  const updateState = useCallback((updates: Partial<OnboardingState>) => {
    setState(prev => {
      const newState = {
        ...prev,
        ...updates,
        lastUpdatedAt: new Date().toISOString()
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(newState));
      return newState;
    });
  }, []);
  
  // Track time
  useEffect(() => {
    const interval = setInterval(() => {
      setState(prev => {
        if (!prev) return prev;
        const newState = {
          ...prev,
          totalTimeSpent: prev.totalTimeSpent + 1
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(newState));
        return newState;
      });
    }, 1000);
    
    return () => clearInterval(interval);
  }, []);
  
  const clearState = useCallback(() => {
    localStorage.removeItem(STORAGE_KEY);
    setState(null);
  }, []);
  
  return { state, updateState, clearState };
}
```

### 3.3 Resume Logic

```typescript
// In /onboarding/page.tsx

export default function OnboardingPage() {
  const { state } = useOnboardingState();
  const router = useRouter();
  
  useEffect(() => {
    // Check if already completed
    if (state?.currentStep === 'complete') {
      router.push('/dashboard');
      return;
    }
    
    // Resume from saved step
    // Component renders based on state.currentStep
  }, [state]);
  
  if (!state) return <Loading />;
  
  return (
    <OnboardingLayout>
      {state.currentStep === 'welcome' && <WelcomeStep />}
      {state.currentStep === 'channel' && <ChannelStep />}
      {state.currentStep === 'bot' && <BotStep />}
      {state.currentStep === 'audience' && <AudienceStep />}
      {state.currentStep === 'automation' && <AutomationStep />}
      {state.currentStep === 'complete' && <CompleteStep />}
    </OnboardingLayout>
  );
}
```

---

## 4. Database Schema

### 4.1 User Model Updates

```prisma
model User {
  id                    String    @id @default(cuid())
  email                 String    @unique
  
  // === PERSONA TYPE (from onboarding) ===
  personaType           String?   // 'beginner' | 'creator' | 'monetizer' | 'power_user'
  experienceLevel       String?   // 'beginner' | 'intermediate' | 'advanced'
  hasAmazonAssociates   Boolean   @default(false)
  
  // === ONBOARDING STATE ===
  onboardingCompletedAt DateTime?
  onboardingSkippedSteps String[]  @default([])
  
  // === NOTIFICATION PREFERENCES ===
  telegramUserId        String?   // For personal notifications
  notifyOnDealPublished Boolean   @default(false)
  notifyOnInsights      Boolean   @default(true)
  notifyOnHealthAlert   Boolean   @default(true)
  
  // Relations
  channels              Channel[]
  credentials           Credential[]
  automationRules       AutomationRule[]
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
}
```

### 4.2 Channel Model Updates

```prisma
model Channel {
  id                     String    @id @default(cuid())
  userId                 String
  user                   User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // === PLATFORM INFO ===
  platform               String    @default("TELEGRAM")
  channelId              String    // Platform-specific ID
  name                   String
  username               String?
  
  // === AUDIENCE TYPE (from onboarding or inferred) ===
  audienceType           String?   // 'product_hunters' | 'deal_explorers' | 'niche_focused' | 'unknown'
  audienceTypeSource     String?   // 'onboarding' | 'inferred'
  audienceTypeConfidence Float?    @default(0.5)
  
  // === MEMBER TRACKING ===
  memberCount            Int?
  memberCountUpdatedAt   DateTime?
  
  // === HEALTH ===
  healthScore            Float?
  healthCalculatedAt     DateTime?
  
  // Relations
  credentialId           String
  credential             Credential @relation(fields: [credentialId], references: [id])
  insights               ChannelInsights?
  automationRules        AutomationRule[]
  
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  
  @@unique([userId, channelId])
  @@index([userId])
}
```

---

## 5. API Endpoints

### 5.1 Validation Endpoints

```typescript
// POST /api/validate/telegram-channel
interface ValidateChannelRequest {
  channelIdentifier: string; // @username or ID
}
interface ValidateChannelResponse {
  valid: boolean;
  channel?: {
    id: string;
    username: string;
    title: string;
    memberCount: number;
    isPublic: boolean;
  };
  error?: 'CHANNEL_NOT_FOUND' | 'NOT_ADMIN' | 'PRIVATE_NO_ACCESS';
}

// POST /api/validate/telegram-token
interface ValidateTokenRequest {
  token: string;
}
interface ValidateTokenResponse {
  valid: boolean;
  bot?: {
    id: number;
    username: string;
    firstName: string;
  };
  error?: 'INVALID_TOKEN' | 'TOKEN_REVOKED';
}

// POST /api/validate/telegram-bot-admin
interface ValidateBotAdminRequest {
  token: string;
  channelId: string;
}
interface ValidateBotAdminResponse {
  valid: boolean;
  permissions?: {
    canPostMessages: boolean;
    canEditMessages: boolean;
    canDeleteMessages: boolean;
  };
  error?: 'BOT_NOT_MEMBER' | 'BOT_NOT_ADMIN' | 'MISSING_POST_PERMISSION';
}
```

### 5.2 Resource Creation Endpoints

```typescript
// POST /api/user/credentials
interface CreateCredentialRequest {
  type: 'TELEGRAM_BOT';
  name: string;
  token: string; // will be encrypted
}
interface CreateCredentialResponse {
  id: string;
  type: string;
  name: string;
  createdAt: string;
}

// POST /api/user/channels
interface CreateChannelRequest {
  platform: 'TELEGRAM';
  channelId: string;
  name: string;
  username?: string;
  credentialId: string;
  memberCount?: number;
  audienceType?: AudienceType;
}
interface CreateChannelResponse {
  id: string;
  platform: string;
  name: string;
  channelId: string;
}

// PATCH /api/auth/persona
interface UpdatePersonaRequest {
  experienceLevel?: string;
  hasAmazonAssociates?: boolean;
  personaType?: string;
  onboardingCompletedAt?: string;
}
```

---

## 6. Analytics Events

### 6.1 Event Catalog

```typescript
// Event definitions
const ONBOARDING_EVENTS = {
  // Flow events
  STARTED: 'onboarding_started',
  COMPLETED: 'onboarding_completed',
  ABANDONED: 'onboarding_abandoned',
  RESUMED: 'onboarding_resumed',
  
  // Step events
  WELCOME_COMPLETED: 'onboarding_welcome_completed',
  CHANNEL_CONNECTED: 'onboarding_channel_connected',
  CHANNEL_SKIPPED: 'onboarding_channel_skipped',
  BOT_VERIFIED: 'onboarding_bot_verified',
  BOT_SKIPPED: 'onboarding_bot_skipped',
  AUDIENCE_SELECTED: 'onboarding_audience_selected',
  AUTOMATION_CREATED: 'onboarding_automation_created',
  AUTOMATION_SKIPPED: 'onboarding_automation_skipped',
  
  // Engagement events
  HELP_CLICKED: 'onboarding_help_clicked',
  VIDEO_WATCHED: 'onboarding_video_watched',
  QUICK_START_USED: 'onboarding_quick_start_used',
  
  // Error events
  ERROR_ENCOUNTERED: 'onboarding_error_encountered',
  VALIDATION_FAILED: 'onboarding_validation_failed',
  
  // Timing events
  STEP_TIME: 'onboarding_step_time'
};
```

### 6.2 Event Properties

```typescript
// onboarding_started
{
  source: 'signup' | 'magic_link' | 'direct',
  referrer?: string
}

// onboarding_welcome_completed
{
  experienceLevel: string,
  hasAmazonAssociates: boolean,
  personaType: string,
  timeSpent: number // seconds
}

// onboarding_channel_connected
{
  channelUsername: string,
  memberCount: number,
  isPublic: boolean,
  timeSpent: number
}

// onboarding_bot_verified
{
  botUsername: string,
  timeSpent: number
}

// onboarding_audience_selected
{
  audienceType: string,
  timeSpent: number
}

// onboarding_automation_created
{
  automationName: string,
  categories: string[],
  schedulePreset: string,
  timeSpent: number
}

// onboarding_completed
{
  personaType: string,
  audienceType: string,
  totalTimeSpent: number,
  skippedSteps: string[],
  automationCreated: boolean
}

// onboarding_error_encountered
{
  step: string,
  errorType: string,
  errorMessage: string
}
```

### 6.3 Tracking Implementation

```typescript
// lib/analytics.ts

import posthog from 'posthog-js';

export function trackOnboardingEvent(
  event: string, 
  properties?: Record<string, any>
) {
  posthog.capture(event, {
    ...properties,
    timestamp: new Date().toISOString(),
    sessionId: getSessionId()
  });
}

// Usage in components
trackOnboardingEvent(ONBOARDING_EVENTS.WELCOME_COMPLETED, {
  experienceLevel: 'intermediate',
  hasAmazonAssociates: true,
  personaType: 'monetizer',
  timeSpent: 45
});
```

---

## 7. Error Handling

### 7.1 Error Types

```typescript
enum OnboardingError {
  // Channel errors
  CHANNEL_NOT_FOUND = 'channel_not_found',
  NOT_CHANNEL_ADMIN = 'not_channel_admin',
  CHANNEL_PRIVATE = 'channel_private',
  
  // Bot errors
  INVALID_TOKEN = 'invalid_token',
  TOKEN_REVOKED = 'token_revoked',
  BOT_NOT_ADMIN = 'bot_not_admin',
  MISSING_PERMISSIONS = 'missing_permissions',
  
  // Network errors
  NETWORK_ERROR = 'network_error',
  TELEGRAM_API_ERROR = 'telegram_api_error',
  
  // Validation errors
  INVALID_INPUT = 'invalid_input',
  
  // Server errors
  SERVER_ERROR = 'server_error'
}
```

### 7.2 Error Messages (Italian)

```typescript
const ERROR_MESSAGES: Record<OnboardingError, { title: string; message: string; action?: string }> = {
  [OnboardingError.CHANNEL_NOT_FOUND]: {
    title: 'Canale non trovato',
    message: 'Non riesco a trovare questo canale. Verifica che il nome sia corretto.',
    action: 'Riprova'
  },
  [OnboardingError.NOT_CHANNEL_ADMIN]: {
    title: 'Non sei admin',
    message: 'Devi essere amministratore del canale per collegarlo.',
    action: 'Verifica permessi'
  },
  [OnboardingError.INVALID_TOKEN]: {
    title: 'Token non valido',
    message: 'Il token che hai inserito non Ã¨ valido. Assicurati di copiarlo da BotFather.',
    action: 'Riprova'
  },
  [OnboardingError.BOT_NOT_ADMIN]: {
    title: 'Bot non Ã¨ admin',
    message: 'Il bot non Ã¨ ancora amministratore del canale. Segui le istruzioni per aggiungerlo.',
    action: 'Ho aggiunto, riprova'
  },
  // ... etc
};
```

### 7.3 Error UI Component

```tsx
// components/onboarding/OnboardingError.tsx

interface OnboardingErrorProps {
  error: OnboardingError;
  onRetry?: () => void;
  onHelp?: () => void;
}

export function OnboardingError({ error, onRetry, onHelp }: OnboardingErrorProps) {
  const { title, message, action } = ERROR_MESSAGES[error];
  
  return (
    <div className="bg-red-50 border border-red-200 rounded-lg p-4">
      <div className="flex items-start gap-3">
        <AlertCircle className="text-red-500 w-5 h-5 mt-0.5" />
        <div className="flex-1">
          <h4 className="font-medium text-red-800">{title}</h4>
          <p className="text-red-700 text-sm mt-1">{message}</p>
          <div className="flex gap-2 mt-3">
            {onRetry && (
              <Button variant="outline" size="sm" onClick={onRetry}>
                {action || 'Riprova'}
              </Button>
            )}
            {onHelp && (
              <Button variant="ghost" size="sm" onClick={onHelp}>
                Hai bisogno di aiuto?
              </Button>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
```

---

## 8. Component Structure

### 8.1 File Structure

```
apps/web/src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ [locale]/
â”‚       â””â”€â”€ onboarding/
â”‚           â”œâ”€â”€ page.tsx           # Main router
â”‚           â””â”€â”€ layout.tsx         # Onboarding layout
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ onboarding/
â”‚       â”œâ”€â”€ OnboardingLayout.tsx   # Progress bar, container
â”‚       â”œâ”€â”€ OnboardingStep.tsx     # Step wrapper
â”‚       â”œâ”€â”€ OnboardingError.tsx    # Error display
â”‚       â”œâ”€â”€ OnboardingHelp.tsx     # Help modal
â”‚       â”‚
â”‚       â”œâ”€â”€ steps/
â”‚       â”‚   â”œâ”€â”€ WelcomeStep.tsx
â”‚       â”‚   â”œâ”€â”€ ChannelStep.tsx
â”‚       â”‚   â”œâ”€â”€ BotStep.tsx
â”‚       â”‚   â”œâ”€â”€ AudienceStep.tsx
â”‚       â”‚   â”œâ”€â”€ AutomationStep.tsx
â”‚       â”‚   â””â”€â”€ CompleteStep.tsx
â”‚       â”‚
â”‚       â””â”€â”€ shared/
â”‚           â”œâ”€â”€ StepProgress.tsx
â”‚           â”œâ”€â”€ SkipButton.tsx
â”‚           â”œâ”€â”€ BackButton.tsx
â”‚           â””â”€â”€ ContinueButton.tsx
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useOnboardingState.ts
â”‚   â””â”€â”€ useOnboardingAnalytics.ts
â”‚
â””â”€â”€ lib/
    â””â”€â”€ onboarding/
        â”œâ”€â”€ types.ts
        â”œâ”€â”€ constants.ts
        â”œâ”€â”€ validation.ts
        â””â”€â”€ api.ts
```

### 8.2 Layout Component

```tsx
// components/onboarding/OnboardingLayout.tsx

interface OnboardingLayoutProps {
  children: React.ReactNode;
  currentStep: number;
  totalSteps: number;
  title?: string;
  canGoBack?: boolean;
  onBack?: () => void;
}

export function OnboardingLayout({
  children,
  currentStep,
  totalSteps,
  title,
  canGoBack,
  onBack
}: OnboardingLayoutProps) {
  return (
    <div className="min-h-screen bg-gray-50 flex flex-col">
      {/* Header */}
      <header className="bg-white border-b px-4 py-3">
        <div className="max-w-2xl mx-auto flex items-center justify-between">
          <div className="flex items-center gap-4">
            {canGoBack && (
              <button onClick={onBack} className="text-gray-500 hover:text-gray-700">
                <ArrowLeft className="w-5 h-5" />
              </button>
            )}
            <Logo className="h-6" />
          </div>
          <div className="text-sm text-gray-500">
            Step {currentStep} di {totalSteps}
          </div>
        </div>
      </header>
      
      {/* Progress bar */}
      <div className="bg-white border-b">
        <div className="max-w-2xl mx-auto">
          <div className="h-1 bg-gray-200">
            <div 
              className="h-1 bg-cyan-500 transition-all duration-300"
              style={{ width: `${(currentStep / totalSteps) * 100}%` }}
            />
          </div>
        </div>
      </div>
      
      {/* Content */}
      <main className="flex-1 py-8 px-4">
        <div className="max-w-2xl mx-auto">
          {title && (
            <h1 className="text-2xl font-bold text-gray-900 mb-6 text-center">
              {title}
            </h1>
          )}
          {children}
        </div>
      </main>
    </div>
  );
}
```

---

## 9. PostHog Analytics Setup

### 9.1 Funnel Definition

**Primary Funnel: Onboarding Completion**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ONBOARDING FUNNEL                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Step 1: onboarding_started                                     â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%     â”‚
â”‚                                                                 â”‚
â”‚  Step 2: onboarding_welcome_completed                           â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 92%            â”‚
â”‚  â†“ Drop: 8% (abbandono iniziale)                               â”‚
â”‚                                                                 â”‚
â”‚  Step 3: onboarding_channel_connected                           â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 75%                      â”‚
â”‚  â†“ Drop: 17% (problemi canale / skip)                          â”‚
â”‚                                                                 â”‚
â”‚  Step 4: onboarding_bot_verified                                â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 62%                            â”‚
â”‚  â†“ Drop: 13% (setup bot complesso)                             â”‚
â”‚                                                                 â”‚
â”‚  Step 5: onboarding_audience_selected                           â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 58%                              â”‚
â”‚  â†“ Drop: 4% (minimo)                                           â”‚
â”‚                                                                 â”‚
â”‚  Step 6: onboarding_automation_created                          â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 52%                                â”‚
â”‚  â†“ Drop: 6% (skip automation)                                  â”‚
â”‚                                                                 â”‚
â”‚  Step 7: onboarding_completed                                   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 50%                                 â”‚
â”‚                                                                 â”‚
â”‚  Conversion Rate Target: â‰¥60%                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**PostHog Funnel Config:**

```javascript
// PostHog Dashboard > Funnels > New Funnel

{
  name: "Onboarding Completion",
  steps: [
    { event: "onboarding_started" },
    { event: "onboarding_welcome_completed" },
    { event: "onboarding_channel_connected" },
    { event: "onboarding_bot_verified" },
    { event: "onboarding_audience_selected" },
    { event: "onboarding_automation_created" },
    { event: "onboarding_completed" }
  ],
  filters: {
    // Esclude test accounts
    properties: [
      { key: "email", operator: "not_contains", value: "@afflyt.io" }
    ]
  },
  aggregation: "unique_users",
  conversionWindow: {
    value: 7,
    unit: "days"
  },
  breakdown: {
    // Breakdown per persona type
    property: "personaType"
  }
}
```

### 9.2 Secondary Funnels

**Funnel: Quick Start Path**

```javascript
{
  name: "Quick Start Adoption",
  steps: [
    { event: "onboarding_started" },
    { event: "onboarding_quick_start_used" },
    { event: "onboarding_completed" }
  ]
}
// Target: capire quanti usano quick start vs flow completo
```

**Funnel: Bot Setup Success**

```javascript
{
  name: "Bot Setup Success",
  steps: [
    { event: "onboarding_channel_connected" },
    { 
      event: "onboarding_validation_failed",
      properties: { step: "bot" },
      optional: true  // conta anche se non fallisce
    },
    { event: "onboarding_bot_verified" }
  ]
}
// Target: capire difficoltÃ  setup bot
```

**Funnel: Skip Analysis**

```javascript
{
  name: "Skip Behavior",
  steps: [
    { event: "onboarding_started" },
    { 
      event: "onboarding_channel_skipped",
      optional: true
    },
    {
      event: "onboarding_automation_skipped", 
      optional: true
    },
    { event: "onboarding_completed" }
  ]
}
// Target: capire pattern di skip
```

### 9.3 Trend Insights

**Trend 1: Daily Onboarding Starts**

```javascript
{
  name: "Daily Onboarding Volume",
  event: "onboarding_started",
  math: "unique_users",
  interval: "day",
  compare: true,  // vs previous period
  breakdown: {
    property: "source"  // signup, magic_link, direct
  }
}
```

**Trend 2: Completion Rate Over Time**

```javascript
{
  name: "Completion Rate Trend",
  formula: {
    numerator: { event: "onboarding_completed", math: "unique_users" },
    denominator: { event: "onboarding_started", math: "unique_users" }
  },
  interval: "week",
  display: "percentage"
}
```

**Trend 3: Average Time to Complete**

```javascript
{
  name: "Time to Complete Onboarding",
  event: "onboarding_completed",
  math: "avg",
  property: "totalTimeSpent",
  interval: "week"
}
// Target: < 5 minuti
```

**Trend 4: Error Rate**

```javascript
{
  name: "Onboarding Errors",
  event: "onboarding_error_encountered",
  math: "total",
  interval: "day",
  breakdown: {
    property: "errorType"
  }
}
```

**Trend 5: Drop-off by Step**

```javascript
{
  name: "Step Drop-off Rate",
  events: [
    { event: "onboarding_welcome_completed" },
    { event: "onboarding_channel_connected" },
    { event: "onboarding_bot_verified" },
    { event: "onboarding_audience_selected" },
    { event: "onboarding_automation_created" }
  ],
  math: "unique_users",
  interval: "week",
  display: "stacked_area"
}
```

### 9.4 Cohort Analysis

**Cohort: First Week Retention**

```javascript
{
  name: "Onboarding Cohort Retention",
  cohort: {
    event: "onboarding_completed"
  },
  returning: {
    event: "deal_published"  // o altro evento chiave
  },
  period: "week",
  periods: 4
}
// Target: 50%+ return in week 1
```

**Cohort: Persona Performance**

```javascript
{
  name: "Persona Completion Rates",
  event: "onboarding_completed",
  breakdown: "personaType",
  compare: true
}
// Vedere quale persona converte meglio
```

### 9.5 User Paths

**Path Analysis: Where Do Users Drop?**

```javascript
{
  name: "Onboarding User Paths",
  startEvent: "onboarding_started",
  endEvent: "onboarding_completed",
  maxSteps: 15,
  excludeEvents: [
    "pageview",
    "autocapture"
  ]
}
```

### 9.6 Dashboard Setup

**Onboarding Dashboard Widgets:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AFFLYT ONBOARDING DASHBOARD                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Started   â”‚  â”‚  Completed  â”‚  â”‚ Conv. Rate  â”‚  â”‚  Avg   â”‚ â”‚
â”‚  â”‚    Today    â”‚  â”‚   Today     â”‚  â”‚             â”‚  â”‚  Time  â”‚ â”‚
â”‚  â”‚     47      â”‚  â”‚     28      â”‚  â”‚    59.6%    â”‚  â”‚  4:32  â”‚ â”‚
â”‚  â”‚   â†‘ +12%    â”‚  â”‚   â†‘ +8%     â”‚  â”‚   â†‘ +3%     â”‚  â”‚  â†“ -15sâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FUNNEL: Onboarding Completion (Last 7 Days)             â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Started        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%   â”‚  â”‚
â”‚  â”‚  Welcome        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 94%      â”‚  â”‚
â”‚  â”‚  Channel        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 76%            â”‚  â”‚
â”‚  â”‚  Bot            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 58%                  â”‚  â”‚
â”‚  â”‚  Audience       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 55%                   â”‚  â”‚
â”‚  â”‚  Automation     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 51%                    â”‚  â”‚
â”‚  â”‚  Completed      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 48%                     â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Completion by Persona     â”‚  â”‚  Top Errors                â”‚â”‚
â”‚  â”‚                            â”‚  â”‚                            â”‚â”‚
â”‚  â”‚  Power User  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 78%  â”‚  â”‚  bot_not_admin      42%   â”‚â”‚
â”‚  â”‚  Monetizer   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 62%    â”‚  â”‚  invalid_token      28%   â”‚â”‚
â”‚  â”‚  Creator     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 55%     â”‚  â”‚  channel_not_found  18%   â”‚â”‚
â”‚  â”‚  Beginner    â–ˆâ–ˆâ–ˆâ–ˆ 41%      â”‚  â”‚  network_error      12%   â”‚â”‚
â”‚  â”‚                            â”‚  â”‚                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TREND: Completion Rate (Last 30 Days)                   â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  60% â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚       â•­â”€â•®   â•­â”€â”€â”€â”€â”€â•®         â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®        â”‚  â”‚
â”‚  â”‚  50% â”€â•¯  â•°â”€â•¯      â•°â”€â”€â”€â•®â•­â”€â”€â”€â•¯                              â”‚  â”‚
â”‚  â”‚                       â•°â•¯                                  â”‚  â”‚
â”‚  â”‚  40% â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚      W1    W2    W3    W4                                â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Time per Step (Avg)                                     â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Welcome     â–ˆâ–ˆ 0:42                                     â”‚  â”‚
â”‚  â”‚  Channel     â–ˆâ–ˆâ–ˆ 1:15                                    â”‚  â”‚
â”‚  â”‚  Bot         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 2:48  â† Bottleneck               â”‚  â”‚
â”‚  â”‚  Audience    â–ˆ 0:23                                      â”‚  â”‚
â”‚  â”‚  Automation  â–ˆâ–ˆ 0:55                                     â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.7 Alerts Setup

**Alert 1: Low Completion Rate**

```javascript
{
  name: "Onboarding Completion Drop",
  condition: {
    metric: "completion_rate",
    threshold: 40,
    operator: "less_than",
    period: "day"
  },
  notify: ["slack:#product-alerts", "email:marco@afflyt.io"]
}
```

**Alert 2: High Error Rate**

```javascript
{
  name: "Onboarding Errors Spike",
  condition: {
    event: "onboarding_error_encountered",
    threshold: 20,
    operator: "greater_than",
    period: "hour"
  },
  notify: ["slack:#engineering"]
}
```

**Alert 3: Bot Step Drop-off**

```javascript
{
  name: "Bot Step Conversion Drop",
  condition: {
    // Channel â†’ Bot conversion
    formula: "bot_verified / channel_connected",
    threshold: 0.5,
    operator: "less_than",
    period: "day"
  },
  notify: ["slack:#product-alerts"]
}
```

### 9.8 Implementation Code

**PostHog Setup:**

```typescript
// lib/posthog.ts

import posthog from 'posthog-js';

const POSTHOG_KEY = process.env.NEXT_PUBLIC_POSTHOG_KEY!;
const POSTHOG_HOST = process.env.NEXT_PUBLIC_POSTHOG_HOST || 'https://eu.posthog.com';

export function initPostHog() {
  if (typeof window !== 'undefined') {
    posthog.init(POSTHOG_KEY, {
      api_host: POSTHOG_HOST,
      capture_pageview: false, // Manual control
      capture_pageleave: true,
      persistence: 'localStorage',
      autocapture: {
        dom_event_allowlist: ['click', 'submit'],
        element_allowlist: ['button', 'a', 'input', 'select'],
      },
    });
  }
}

export { posthog };
```

**Onboarding Analytics Hook:**

```typescript
// hooks/useOnboardingAnalytics.ts

import { useCallback, useRef, useEffect } from 'react';
import { posthog } from '@/lib/posthog';

interface StepTiming {
  step: string;
  startedAt: number;
}

export function useOnboardingAnalytics() {
  const stepTiming = useRef<StepTiming | null>(null);
  const sessionStart = useRef<number>(Date.now());
  
  // Start tracking a step
  const startStep = useCallback((step: string) => {
    stepTiming.current = {
      step,
      startedAt: Date.now()
    };
  }, []);
  
  // Complete a step
  const completeStep = useCallback((step: string, properties?: Record<string, any>) => {
    const timeSpent = stepTiming.current 
      ? Math.round((Date.now() - stepTiming.current.startedAt) / 1000)
      : 0;
    
    posthog.capture(`onboarding_${step}_completed`, {
      ...properties,
      timeSpent,
      totalTimeSpent: Math.round((Date.now() - sessionStart.current) / 1000)
    });
    
    stepTiming.current = null;
  }, []);
  
  // Track started
  const trackStarted = useCallback((source: string) => {
    sessionStart.current = Date.now();
    posthog.capture('onboarding_started', {
      source,
      referrer: document.referrer || undefined
    });
  }, []);
  
  // Track completed
  const trackCompleted = useCallback((data: {
    personaType: string;
    audienceType: string;
    skippedSteps: string[];
    automationCreated: boolean;
  }) => {
    posthog.capture('onboarding_completed', {
      ...data,
      totalTimeSpent: Math.round((Date.now() - sessionStart.current) / 1000)
    });
  }, []);
  
  // Track error
  const trackError = useCallback((step: string, errorType: string, errorMessage?: string) => {
    posthog.capture('onboarding_error_encountered', {
      step,
      errorType,
      errorMessage
    });
  }, []);
  
  // Track skip
  const trackSkip = useCallback((step: string) => {
    posthog.capture(`onboarding_${step}_skipped`, {
      timeSpent: stepTiming.current 
        ? Math.round((Date.now() - stepTiming.current.startedAt) / 1000)
        : 0
    });
  }, []);
  
  // Track help click
  const trackHelpClick = useCallback((step: string, helpType: string) => {
    posthog.capture('onboarding_help_clicked', {
      step,
      helpType
    });
  }, []);
  
  // Identify user
  const identifyUser = useCallback((userId: string, traits?: Record<string, any>) => {
    posthog.identify(userId, traits);
  }, []);
  
  // Set persona properties
  const setPersona = useCallback((personaType: string, experienceLevel: string) => {
    posthog.people.set({
      personaType,
      experienceLevel,
      onboardingVersion: '2.0'
    });
  }, []);
  
  return {
    startStep,
    completeStep,
    trackStarted,
    trackCompleted,
    trackError,
    trackSkip,
    trackHelpClick,
    identifyUser,
    setPersona
  };
}
```

**Usage in Components:**

```tsx
// components/onboarding/steps/WelcomeStep.tsx

import { useOnboardingAnalytics } from '@/hooks/useOnboardingAnalytics';

export function WelcomeStep() {
  const analytics = useOnboardingAnalytics();
  const [formData, setFormData] = useState<WelcomeSurveyData | null>(null);
  
  // Start tracking on mount
  useEffect(() => {
    analytics.startStep('welcome');
  }, []);
  
  const handleContinue = async () => {
    if (!formData) return;
    
    const personaType = calculatePersonaType(formData);
    
    // Track completion
    analytics.completeStep('welcome', {
      experienceLevel: formData.experienceLevel,
      hasAmazonAssociates: formData.hasAmazonAssociates,
      personaType
    });
    
    // Set persona for future events
    analytics.setPersona(personaType, formData.experienceLevel);
    
    // Proceed to next step
    goToNextStep();
  };
  
  const handleQuickStart = () => {
    posthog.capture('onboarding_quick_start_used');
    // Skip to automation step with defaults
  };
  
  const handleHelpClick = () => {
    analytics.trackHelpClick('welcome', 'amazon_associates_guide');
  };
  
  return (
    // ... UI
  );
}
```

```tsx
// components/onboarding/steps/BotStep.tsx

export function BotStep() {
  const analytics = useOnboardingAnalytics();
  
  useEffect(() => {
    analytics.startStep('bot');
  }, []);
  
  const handleTokenValidation = async (token: string) => {
    try {
      const result = await validateToken(token);
      
      if (!result.valid) {
        analytics.trackError('bot', result.error!, 'Token validation failed');
        return;
      }
      
      // Continue...
    } catch (error) {
      analytics.trackError('bot', 'network_error', error.message);
    }
  };
  
  const handleBotVerified = (botData: BotData) => {
    analytics.completeStep('bot', {
      botUsername: botData.username
    });
    goToNextStep();
  };
  
  const handleWatchVideo = () => {
    analytics.trackHelpClick('bot', 'video_tutorial');
  };
  
  return (
    // ... UI
  );
}
```

### 9.9 A/B Testing Setup

**Experiment: Quick Start Prominence**

```javascript
// PostHog Feature Flag

{
  key: "onboarding-quick-start-prominent",
  variants: {
    control: 50,      // Quick start in footer
    treatment: 50     // Quick start as primary CTA
  },
  filters: {
    groups: [{ 
      properties: [{ key: "personaType", operator: "is_not", value: "power_user" }]
    }]
  }
}
```

```tsx
// In WelcomeStep.tsx

import { useFeatureFlag } from 'posthog-js/react';

export function WelcomeStep() {
  const quickStartProminent = useFeatureFlag('onboarding-quick-start-prominent');
  
  if (quickStartProminent === 'treatment') {
    return (
      <div>
        <h1>Benvenuto in Afflyt!</h1>
        
        {/* Quick Start as primary */}
        <Button variant="primary" onClick={handleQuickStart}>
          Inizia Subito (impostazioni consigliate)
        </Button>
        
        <Button variant="secondary" onClick={showSurvey}>
          Personalizza esperienza
        </Button>
      </div>
    );
  }
  
  // Control: normal flow with quick start in footer
  return (
    <div>
      {/* Normal survey flow */}
      <footer>
        <Button variant="link" onClick={handleQuickStart}>
          Usa impostazioni consigliate â†’
        </Button>
      </footer>
    </div>
  );
}
```

**Experiment: Bot Setup Video**

```javascript
{
  key: "onboarding-bot-video",
  variants: {
    control: 50,      // Text instructions only
    treatment: 50     // Video embedded
  }
}
```

### 9.10 Success Metrics & Targets

| Metric | Current (Baseline) | Target | Alert Threshold |
|--------|-------------------|--------|-----------------|
| Started â†’ Completed | TBD | â‰¥60% | <40% |
| Started â†’ Channel | TBD | â‰¥80% | <65% |
| Channel â†’ Bot | TBD | â‰¥75% | <55% |
| Bot â†’ Completed | TBD | â‰¥85% | <70% |
| Avg Time to Complete | TBD | <5 min | >8 min |
| Quick Start Usage | TBD | 20-30% | >50% (troppo) |
| Error Rate | TBD | <10% | >20% |
| Help Click Rate | TBD | <15% | >30% (UX issue) |

---

## 10. Testing Checklist

### 10.1 Happy Path Tests

- [ ] Complete flow da signup a dashboard
- [ ] Quick Start salta al step 5
- [ ] Canale pubblico si collega correttamente
- [ ] Canale privato (con ID) si collega correttamente
- [ ] Bot token valido viene accettato
- [ ] Bot admin viene verificato correttamente
- [ ] Audience type viene salvato su channel
- [ ] Automazione viene creata con parametri corretti
- [ ] localStorage viene pulito al complete

### 10.2 Error Path Tests

- [ ] Canale non trovato mostra errore corretto
- [ ] Token invalido mostra errore corretto
- [ ] Bot non admin mostra istruzioni
- [ ] Network error mostra retry option
- [ ] Validazione input mostra messaggi corretti

### 10.3 Edge Cases

- [ ] Resume dopo abbandono
- [ ] Resume dopo browser close
- [ ] Skip channel â†’ dashboard incomplete
- [ ] Skip automation â†’ complete ma senza automation
- [ ] Back button mantiene dati
- [ ] Doppio click su continue non duplica

### 10.4 Analytics Tests

- [ ] onboarding_started fires on mount
- [ ] Step events fire con properties corrette
- [ ] onboarding_completed include tutti i dati
- [ ] Error events tracciano errori
- [ ] Time tracking Ã¨ accurato
- [ ] PostHog funnel registra tutti gli step
- [ ] Breakdown per personaType funziona
- [ ] Feature flags A/B test funzionano
- [ ] Alerts si triggano correttamente
- [ ] User properties vengono settate (personaType, experienceLevel)

---

## 11. Implementation Priority

### Phase 1: Core Flow (Week 1)

- [ ] OnboardingLayout + StepProgress
- [ ] WelcomeStep (survey)
- [ ] ChannelStep (connect)
- [ ] BotStep (setup + verify)
- [ ] localStorage persistence
- [ ] Basic error handling

### Phase 2: Intelligence (Week 2)

- [ ] AudienceStep (type selection)
- [ ] AutomationStep (first automation)
- [ ] CompleteStep (celebration)
- [ ] Persona type calculation
- [ ] Skip/resume logic

### Phase 3: Polish (Week 3)

- [ ] PostHog funnel setup
- [ ] PostHog dashboard creation
- [ ] PostHog alerts configuration
- [ ] A/B test feature flags
- [ ] Analytics hook implementation
- [ ] Error messages refinement
- [ ] Help modals
- [ ] Mobile responsive
- [ ] Loading states
- [ ] Animations

---

*Onboarding Specification v2.0 â€” Dicembre 2024*
